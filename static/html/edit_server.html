<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Éditer {{ server.display_name }} - {{ site_name }}</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/edit_server.css', v=ASSET_VERSION) }}">
</head>
<body>
    <a href="{{ url_for('admin_servers') }}" class="back-link">
        <i class="fas fa-arrow-left"></i>
        <span>Retour</span>
    </a>
    
    <div class="container">
        <div class="edit-container">
            <div class="text-center mb-4">
                <div class="logo-Galaxy">
                    <span class="logo-vol">VOL</span><span class="logo-tre">TRE</span>
                </div>
                <h1 class="header-title">
                    <i class="fas fa-edit me-3"></i>
                    Éditer {{ server.display_name }}
                </h1>
                <p class="text-muted">Modifiez la configuration du serveur <code>{{ server_id }}</code></p>
            </div>

            <form method="POST">
                <!-- SÉCURITÉ: Token CSRF -->
                <input type="hidden" name="csrf_token" value="{{ csrf_token() if csrf_token is defined else '' }}">
                <!-- Informations générales -->
                <div class="form-section">
                    <h4 class="section-title">
                        <i class="fas fa-info-circle me-2"></i>
                        Informations générales
                    </h4>
                    
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label for="name" class="form-label">Nom technique</label>
                            <input type="text" class="form-control technical-name-field" id="name" name="name" 
                           value="{{ server.name or server_id }}" readonly>
                            <div class="form-text">Nom utilisé en interne (non modifiable)</div>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label for="display_name" class="form-label">Nom d'affichage</label>
                            <input type="text" class="form-control" id="display_name" name="display_name" 
                                   value="{{ server.display_name }}" required>
                            <div class="form-text">Nom affiché aux utilisateurs</div>
                        </div>
                    </div>
                    
                    <div class="mb-3">
                        <label for="description" class="form-label">Description</label>
                        <textarea class="form-control" id="description" name="description" rows="3">{{ server.description }}</textarea>
                        <div class="form-text">Description du serveur</div>
                    </div>
                    
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label for="status" class="form-label">Statut</label>
                            <select class="form-control" id="status" name="status">
                                <option value="online" {% if server.status == 'online' %}selected{% endif %}>En ligne</option>
                                <option value="offline" {% if server.status == 'offline' %}selected{% endif %}>Hors ligne</option>
                                <option value="maintenance" {% if server.status == 'maintenance' %}selected{% endif %}>Maintenance</option>
                            </select>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label for="database_uri" class="form-label">URI Base de données</label>
                            <input type="text" class="form-control" id="database_uri" name="database_uri" 
                                   value="{{ server.database_uri }}">
                            <div class="form-text">Connexion à la base de données MySQL</div>
                        </div>
                    </div>
                </div>

                <!-- Configuration Discord (Rôles et Salon) -->
                <div class="form-section">
                    <h4 class="section-title">
                        <i class="fab fa-discord me-2"></i>
                        Configuration Discord
                    </h4>
                    
                    <div class="logo-refresh-wrapper">
                        <div class="logo-preview-card">
                            <h5 class="logo-preview-title">Logo actuel</h5>
                            <div class="logo-preview" id="logo-preview">
                                {% if discord_icon %}
                                    <img src="{{ discord_icon }}" alt="Logo Discord" id="current-logo-img">
                                {% else %}
                                    <div class="logo-placeholder" id="logo-placeholder">
                                        <i class="fab fa-discord"></i>
                                        <span>Aucun logo détecté</span>
                                    </div>
                                {% endif %}
                            </div>
                            <p class="logo-preview-hint text-muted">Le logo est récupéré automatiquement depuis la bannière du serveur Discord.</p>
                        </div>
                        <div class="logo-actions">
                            <button type="button"
                                    class="btn btn-refresh-logo"
                                    id="refresh-logo-btn"
                                    data-refresh-url="{{ url_for('refresh_server_logo', server_id=server_id) }}">
                                <i class="fas fa-sync-alt me-2"></i>
                                Rafraîchir le logo Discord
                            </button>
                            <div class="logo-feedback text-start" id="refresh-logo-feedback"></div>
                        </div>
                    </div>
                    
                    <div class="mb-3">
                        <label for="discord_guild_id" class="form-label">Guild ID</label>
                        <input type="text" class="form-control" id="discord_guild_id" name="discord_guild_id" 
                               value="{{ server.discord.guild_id if server.discord else '' }}">
                        <div class="form-text">ID du serveur Discord</div>
                    </div>
                    
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label for="discord_role_staff" class="form-label">Rôle Staff</label>
                            <input type="text" class="form-control" id="discord_role_staff" name="discord_role_staff" 
                                   value="{{ server.discord.role_id_staff if server.discord else '' }}">
                            <div class="form-text">ID du rôle staff</div>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label for="discord_role_admin" class="form-label">Rôle Admin</label>
                            <input type="text" class="form-control" id="discord_role_admin" name="discord_role_admin" 
                                   value="{{ server.discord.role_id_admin if server.discord else '' }}">
                            <div class="form-text">ID du rôle admin</div>
                        </div>
                    </div>
                    
                    <div class="mb-3">
                        <label for="discord_channel_id" class="form-label">ID du Salon Discord</label>
                        <input type="text" class="form-control" id="discord_channel_id" name="discord_channel_id" 
                               value="{{ server.discord.channel_id if server.discord else '' }}">
                        <div class="form-text">ID du salon Discord où le bot enverra les logs (activer le mode développeur Discord pour obtenir l'ID)</div>
                    </div>
                </div>

                <!-- Boutons d'action -->
                <div class="text-center">
                    <button type="submit" class="btn btn-save me-3">
                        <i class="fas fa-save me-2"></i>
                        Sauvegarder
                    </button>
                    <a href="{{ url_for('admin_servers') }}" class="btn btn-cancel">
                        <i class="fas fa-times me-2"></i>
                        Annuler
                    </a>
                </div>
            </form>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="{{ url_for('static', filename='js/edit_server.js', v=ASSET_VERSION) }}"></script>
</body>
</html>